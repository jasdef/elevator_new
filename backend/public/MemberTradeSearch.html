
<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SCG</title>
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->
    <link href="../vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- bootstrap-select -->
    <link rel="stylesheet" href="../vendors/bootstrap-select/css/bootstrap-select.min.css">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <link href="../vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
</head>

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <!--Menu-->
            <!--Top-->
            <!-- page content -->
            <div class="right_col" role="main">
                <div class="row">
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div class="x_panel">
                                <div class="x_content">
                                    <div class="form-horizontal form-label-left" novalidate>
                                        <div class="item form-group">
                                            <label class="control-label col-md-3 col-sm-3 col-xs-12">交易時間</label>
                                            <div class="col-md-9 col-sm-9 col-xs-12">
                                                <input type="text" id="MemberDepositTime" class="form-control col-md-9 col-xs-12" type="text"/>
                                            </div>
                                        </div>
                                        <div class="item form-group">
                                            <label class="control-label col-md-3 col-sm-3 col-xs-12">交易代碼
                                            </label>
                                            <div class="col-md-9 col-sm-9 col-xs-12">
                                                <input id="TradeSeq" class="form-control col-md-7 col-xs-12" placeholder="" type="text">
                                            </div>
                                        </div>
                                        <div class="item form-group">
                                            <label class="control-label col-md-3 col-sm-3 col-xs-12">交易類型
                                            </label>
                                            <div class="col-md-9 col-sm-9 col-xs-12">
                                                <select name="TradeType" id="TradeType" class="form-control" required="required">
                                                    <option class="text-center" value="all" selected>全部</option>
                                                    <option class="text-center" value="mycard">MyCard</option>
                                                    <option class="text-center" value="funpay">Funpay</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ln_solid"></div>
                                    <div class="form-group">
                                        <div class="col-md-6 col-md-offset-4">
                                            <button class="btn btn-danger">清除</button>
                                            <button class="btn btn-success">搜尋</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <div class="x_panel">
                                <div class="x_content">
                                    <div class="form-horizontal form-label-left" novalidate>
                                        <div class="item form-group">
                                            <div class="item form-group">
                                                <label class="control-label col-md-3 col-sm-3 col-xs-12">會員ID
                                                </label>
                                                <div class="col-md-9 col-sm-9 col-xs-12">
                                                    <input id="MemberId" class="date-picker form-control col-md-7 col-xs-12" placeholder="" type="text" readonly="readonly">
                                                </div>
                                            </div>
                                            <div class="item form-group">
                                                <label class="control-label col-md-3 col-sm-3 col-xs-12">遊戲暱稱
                                                </label>
                                                <div class="col-md-9 col-sm-9 col-xs-12">
                                                    <input id="MemberNickName" class="form-control col-md-7 col-xs-12" placeholder="" type="text" readonly="readonly">
                                                </div>
                                            </div>
                                            <div class="item form-group">
                                                <label class="control-label col-md-3 col-sm-3 col-xs-12">真實姓名
                                                </label>
                                                <div class="col-md-9 col-sm-9 col-xs-12">
                                                    <input id="MemberName" class="form-control col-md-7 col-xs-12" placeholder="" type="text" readonly="readonly">
                                                </div>
                                            </div>
                                            <div class="item form-group">
                                                <label class="control-label col-md-3 col-sm-3 col-xs-12">帳號
                                                </label>
                                                <div class="col-md-9 col-sm-9 col-xs-12">
                                                    <input id="MemberAccount" class="form-control col-md-7 col-xs-12" placeholder="" type="text" readonly="readonly">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Member List</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table id="datatable" class="table table-striped table-bordered bulk_action">
                                    <thead>
                                        <tr>
                                            <th>Id</th>
                                            <th>會員Id</th>
                                            <th>交易序號</th>
                                            <th>金額</th>
                                            <th>幣別</th>
                                            <th>金流類型</th>
                                            <th>ProductId</th>
                                            <th>狀態碼</th>
                                            <th>付款類型</th>
                                            <th>回傳狀態碼</th>
                                            <th>回傳訊息</th>
                                            <th>MyCard PayResult</th>
                                            <th>MyCard TradeNumber</th>
                                            <th>MyCard TradeSeq</th>
                                            <th>MyCard PromoCode</th>
                                            <th>MyCard Type</th>
                                            <th>備註</th>
                                            <th>產生時間</th>
                                            <th>修改時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->
            <!--footer-->
        </div>
    </div>
    <div id="loading-cover" style="width: 100%; height: 100%; background: rgba(0,0,0,.5); position: fixed; display: none; z-index: 999999; top: 0; left: 0;">
        <div id="loading-icon" style="width: 85px; height: 65px; margin: -42.5px 0 0 -32.5px; top: 50%; left: 50%; position: fixed;">
            <i class="fa fa-circle-o-notch fa-spin fa-5x fa-fw" style="color: #FFF;"></i>
        </div>
    </div>
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- validator -->
    <script src="../vendors/validator/validator.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- Datatables -->
    <script src="../vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="../vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="../vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="../vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="../vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="../vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
    <script src="../vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
    <script src="../vendors/jszip/dist/jszip.min.js"></script>
    <script src="../vendors/pdfmake/build/pdfmake.min.js"></script>
    <script src="../vendors/pdfmake/build/vfs_fonts.js"></script>
    <script src="../vendors/moment/min/moment.min.js"></script>
    <!-- bootstrap-select -->
    <script src="../vendors/bootstrap-select/js/bootstrap-select.min.js"></script>
    <script src="../vendors/bootstrap-select/js/i18n/defaults-zh_TW.min.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>
    <script src="../vendors/xlsx/dist/xlsx.full.min.js"></script>


    <script>
    $(document).ready(function() {    
        var $_GET = {};
        document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function() {
            function decode(s) {
                return decodeURIComponent(s.split("+").join(" "));
            }
            $_GET[decode(arguments[1])] = decode(arguments[2]);
        });  
        
        $("#MemberId").val($_GET["MemberId"]);
        $("#MemberNickName").val($_GET["NickName"]);
        $("#MemberName").val($_GET["Name"]);
        $("#MemberAccount").val($_GET["Account"]);

        $('#TradeType').selectpicker({
            showTick: true
        });  
        $('#MemberDepositTime').daterangepicker({
            locale: {
                format: 'YYYY-MM-DD HH:mm:ss'
            },
            startDate: moment(),
            endDate: moment(),
            timePicker: true,
            timePicker24Hour: true,
            timePickerSeconds: true,
            ranges: {
                'Today': [moment().startOf('day'), moment().endOf('day')],
                'Tomorrow': [moment().add(1, 'days').startOf('day'), moment().add(1, 'days').endOf('day')],
                '7 Days': [moment().startOf('day'), moment().add(6, 'days').endOf('day')],
                '30 Days': [moment().startOf('day'), moment().add(29, 'days').endOf('day')],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'This Year': [moment().startOf('year'), moment().endOf('year')]
            }
        });

        function clear(e) {
            e.preventDefault();
        }

        function datacheck() {
            var TradeSeq = $('#TradeSeq').val();
            var TradeType = $('#TradeType').val();
            var MemberDepositTimeStart = $('#MemberDepositTime').data('daterangepicker').startDate.format('YYYY-MM-DD HH:mm:ss');
            var MemberDepositTimeEnd = $('#MemberDepositTime').data('daterangepicker').endDate.format('YYYY-MM-DD HH:mm:ss');

            var result = { r: true, MemberId: $_GET["MemberId"] };
            if (TradeType !== "" && TradeType != "all") {
                result.r = true;
                result.TradeType = TradeType;
            }
            if (TradeSeq !== "") {
                result.r = true;
                result.TradeSeq = TradeSeq;
            }
            if (MemberDepositTimeStart !== "" && MemberDepositTimeEnd !== "") {
                result.r = true;
                result.MemberDepositTimeStart = MemberDepositTimeStart;
                result.MemberDepositTimeEnd = MemberDepositTimeEnd;
            }
            return result;
        }

        function search(e) {
            e.preventDefault();
            var result = datacheck();
            console.log(result);
            if (!result.r) {
                return;
            }
            
            if (typeof table !== "undefined") {
                table.destroy();
            }

            table = $('#datatable').DataTable({
                "processing": true,
                "serverSide": true,
                "lengthMenu": [
                    [30, 50, 100],
                    [30, 50, 100]
                ],
                "columns": [
                    //{ "defaultContent": "" },
                    { "data": "Id" },
                    { "data": "MemberId" },
                    { "data": "FacTradeSeq" },
                    { "data": "Amount" },
                    { "data": "Currency" },
                    { "data": "CashFlow" },
                    { "data": "ProductId" },
                    { "data": "StatusCode" },
                    { "data": "MycardPaymentType" },
                    { "data": "MycardReturnCode" },
                    { "data": "MycardReturnMsg" },
                    { "data": "MycardPayResult" },
                    { "data": "MycardTradeNo" },
                    { "data": "MycardTradeSeq" },
                    { "data": "MycardPromoCode" },
                    { "data": "MycardType" },
                    { "data": "Notes" },
                    { "data": "CreateTime" },
                    { "data": "ModifyTime" },
                ],
                'rowCallback': function(row, value, dataIndex) {
                    //console.log(value);

                    var ReturnMsg = value.CashFlow == "funapy" ? value.FunpayReturnMsg : value.MycardReturnMsg;
                    var ReturnCode = value.CashFlow == "funapy" ? value.FunpayReturnCode : value.MycardReturnCode;
                    var TradeNo = value.CashFlow == "funapy" ? value.FunpayTradeNo : value.MycardTradeNo;
                    var PaymentType = value.CashFlow == "funapy" ? value.FunpayPaymentType : value.MycardPaymentType;
                    var Notes = value.Notes;
                    var FunpayItemCode = value.FunpayItemCode;
                    var MycardPayResult = value.MycardPayResult;
                    var MycardPromoCode = value.MycardPromoCode;
                    var MycardTradeSeq = value.MycardTradeSeq;
                    var MycardType = value.MycardType;

                    $('td:eq(0)', row).html(value.Id);
                    $('td:eq(1)', row).html(value.MemberId);
                    $('td:eq(2)', row).html(value.FacTradeSeq);
                    $('td:eq(3)', row).html(value.Amount);
                    $('td:eq(4)', row).html(value.Currency);
                    $('td:eq(5)', row).html(value.CashFlow);
                    $('td:eq(6)', row).html(value.ProductId);
                    $('td:eq(7)', row).html(value.StatusCode);
                    $('td:eq(8)', row).html(PaymentType);
                    $('td:eq(9)', row).html(ReturnCode);
                    $('td:eq(10)', row).html(ReturnMsg);
                    $('td:eq(11)', row).html(MycardPayResult);
                    $('td:eq(12)', row).html(TradeNo);
                    $('td:eq(13)', row).html(MycardTradeSeq);
                    $('td:eq(14)', row).html(MycardPromoCode);
                    $('td:eq(15)', row).html(MycardType);
                    $('td:eq(16)', row).html(value.Notes);
                    $('td:eq(17)', row).html(moment(value.CreateTime).format("YYYY-MM-DD HH:mm:ss"));
                    $('td:eq(18)', row).html(moment(value.ModifyTime).format("YYYY-MM-DD HH:mm:ss"));
                },
                "ajax": {
                    "url": "/MemberTradeSearch",
                    "type": "POST",
                    "data": result,
                    "cache": "false",
                    "async": "true",
                    "dataType": 'json'
                }
            });
        };

        // function search(e) {
        //     e.preventDefault();
        //     var result = datacheck();
        //     console.log(result);
        //     if (!result.r) {
        //         return;
        //     }
        //     $('.input-sm').val('');
        //     table.search('').draw();
        //     table.clear().draw();
        //     var data = [];
        //     $('#loading-cover').fadeIn(100);
        //     $.ajax({
        //         type: 'POST',
        //         url: "/MemberTradeSearch",
        //         data: result,
        //         cache: false,
        //         async: true,
        //         dataType: 'json',
        //         success: function(msg) {
        //             if (msg.code == -1) { msg.msg } else {
        //                 msg.data.forEach(function(value) {
        //                     console.log(value);
        //                     var ReturnMsg = value.CashFlow == "funapy" ? value.FunpayReturnMsg : value.MycardReturnMsg;
        //                     var ReturnCode = value.CashFlow == "funapy" ? value.FunpayReturnCode : value.MycardReturnCode;
        //                     var TradeNo = value.CashFlow == "funapy" ? value.FunpayTradeNo : value.MycardTradeNo;
        //                     var PaymentType = value.CashFlow == "funapy" ? value.FunpayPaymentType : value.MycardPaymentType;
        //                     var Notes = value.Notes;
        //                     var FunpayItemCode = value.FunpayItemCode;
        //                     var MycardPayResult = value.MycardPayResult;
        //                     var MycardPromoCode = value.MycardPromoCode;
        //                     var MycardTradeSeq = value.MycardTradeSeq;
        //                     var MycardType = value.MycardType;

        //                     data.push([
        //                         isNullOrEmpty(value.Id, ""),
        //                         isNullOrEmpty(value.MemberId, ""),
        //                         isNullOrEmpty(value.FacTradeSeq, ""),
        //                         isNullOrEmpty(value.Amount, ""),
        //                         isNullOrEmpty(value.Currency, ""),
        //                         isNullOrEmpty(value.CashFlow, ""),
        //                         isNullOrEmpty(value.ProductId, ""),
        //                         isNullOrEmpty(value.StatusCode, ""),
        //                         isNullOrEmpty(PaymentType, ""),
        //                         isNullOrEmpty(ReturnCode, ""),
        //                         isNullOrEmpty(ReturnMsg, ""),
        //                         isNullOrEmpty(MycardPayResult, ""),
        //                         isNullOrEmpty(TradeNo, ""),
        //                         isNullOrEmpty(MycardTradeSeq, ""),
        //                         isNullOrEmpty(MycardPromoCode, ""),
        //                         isNullOrEmpty(PaymentType, ""),
        //                         isNullOrEmpty(MycardType, ""),
        //                         isNullOrEmpty(value.Notes, ""),
        //                         isNullOrEmpty(value.CreateTime, "") == "" ? "" : moment(value.CreateTime).format("YYYY-MM-DD HH:mm:ss"),
        //                         isNullOrEmpty(value.ModifyTime, "") == "" ? "" : moment(value.ModifyTime).format("YYYY-MM-DD HH:mm:ss")
        //                     ]);
        //                 });
        //                 table.rows.add(data).draw();
        //             }
        //         },
        //         error: function(xhr, desc, err) {
        //             alert("HTTP Status code:" + xhr.status);
        //         }
        //     }).done(function() {
        //         $('#loading-cover').fadeOut(100);
        //     });
        // }

        function thousandComma(number) {
            var num = number.toString();
            var pattern = /(-?\d+)(\d{3})/;

            while (pattern.test(num)) {
                num = num.replace(pattern, "$1,$2");
            }
            return num;
        }

        function isNullOrEmpty(obj, s) {
             if (obj == 'undefined' || obj == null || obj == 0 || obj == '')
                return s;
            return obj;
        }

        $('.btn.btn-danger')
            .on('mousedown', clear)
            .on('touchstart', clear);

        $('.btn.btn-success')
            .on('mousedown', search)
            .on('touchstart', search);
    });
    </script>
</body>

</html>