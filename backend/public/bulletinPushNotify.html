<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<!-- Meta, title, CSS, favicons, etc. -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SCG</title>
	<!-- Bootstrap -->
	<link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link href="../vendors/font-awesome/css/font-awesome.css" rel="stylesheet">
	<!-- NProgress -->
	<link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
	<!-- Datatables -->
	<link href="../vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
	<link href="../vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
	<link href="../vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
	<link href="../vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
	<link href="../vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
	<!-- Custom Theme Style -->
	<link href="../build/css/custom.min.css" rel="stylesheet">
	<!-- bootstrap-daterangepicker -->
	<link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
	<!-- bootstrap-select -->
	<link rel="stylesheet" href="../vendors/bootstrap-select/css/bootstrap-select.min.css">
    <link href="../vendors/bootstrap-notify/animate.min.css" rel="stylesheet">
	<!-- jquery-ui -->
	<link rel="stylesheet" href="../vendors/jquery-ui/jquery-ui.min.css">
	<style type="text/css" media="screen">
	.popover {
		max-width: 700px;
	}

	.form-control[readonly] {
		background-color: transparent;
	}

	.text-ellipsis {
		/*width: 200px;*/
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
		margin: 0;
	}
    #datatable td:nth-child(7) span.label {
        display: block;
    }
	#datatable tbody td {
		overflow: hidden;
		vertical-align: middle;
	}

	#datatable {
		table-layout: fixed;
	}

	#RateTable, #edit_RateTable {
		margin: 0;
	}

	#RateTable td, #edit_RateTable td {
		vertical-align: middle;
		padding: 10px 2px 0 2px;
	}

	#RateTable td h1, #edit_RateTable td h1 {
		margin-top: 0;
	}

	#TimePreview, #edit_TimePreview {
		line-height: 23px;
	}
	/*圖片選擇*/

	#gallery-sortable li {
		margin: .2%;
		width: 19.5%;
		height: 181px;
		padding: 5px;
	}

	.thumbnail {
		height: auto;
		margin-bottom: 0px;
	}

	#gallery-sortable .pinSize {
		overflow: hidden;
		height: 95px;
		position: relative;
	}

	#gallery-sortable .over-img-block {
		position: absolute;
		padding: 10px;
		width: 100%;
		height: 40px;
		z-index: 99;
		top: 0;
		left: 0;
	}

	#gallery-sortable .edit-over-item {
		position: relative;
		background: rgba(180, 180, 180, .3);
		width: 100%;
		height: 160px;
		padding: 32px 10px 10px 10px;
		margin-bottom: -160px;
		z-index: 999;
	}

	#gallery-sortable p {
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.label {
		font-size: 100%;
	}

	.blur {
		filter: blur(3px);
	}

	#gallery-sortable>li.selected[data-pid]>.thumbnail {
		box-shadow: 0 0 1px 3px rgba(0, 130, 255, 0.7);
		border-color: rgba(0, 0, 0, 0);
	}
	/*圖片選擇*/
	/*圖片放大瀏覽*/

	#bs-picture-modal-box {
		z-index: 1070;
	}

	#bs-picture-modal-box+div.modal-backdrop {
		z-index: 1060;
	}

	.pinSize img.img-responsive {
		cursor: pointer;
		-webkit-transition: transform .5s ease;
		-moz-transition: transform .5s ease;
		-ms-transition: transform .5s ease;
		-o-transition: transform .5s ease;
		transition: transform .5s ease;
	}

	.pinSize img.img-responsive:hover {
		-webkit-transform: scale(2.2) rotateZ(15deg);
		-moz-transform: scale(2.2) rotateZ(15deg);
		-ms-transform: scale(2.2) rotateZ(15deg);
		-o-transform: scale(2.2) rotateZ(15deg);
		transform: scale(2.2) rotateZ(15deg);
	}
	/*圖片放大瀏覽*/
	.form-control-feedback{
		margin-top: 5px;
	}
	.has-feedback .form-control{
		padding-right: 25px;
	}
	textarea {
		resize: vertical;
	}
	.alert h5{
        margin: 0 0 0 15px;
        font-size: 1.3em;
    }
    .alert i{
        margin-right: 5px;
    }
    #datatable_wrapper > .row {
        overflow: visible!important;
    }
    #datatable .has-feedback{
    	width: 50%;
    	margin: 0;
    	padding: 2px;
    }
    #datatable .has-feedback .input-group{
    	margin: 0;
    }
    #datatable .has-feedback .input-group .form-control{
    	padding-right: 0;
    	border-radius: 0 4px 4px 0 ;
    }
	</style>
</head>

<body class="nav-md">
	<div class="container body">
		<div class="main_container">
			<!--Menu-->
			<!--Top-->
			<!-- page content -->
			<div class="right_col" role="main">
				<div class="row">
					<div class="clearfix"></div>
					<div class="row">
						<div class="col-md-12 col-sm-12 col-xs-12">
							<div class="x_panel">
								<div class="x_title">
									<h2>發送系統推播</h2>
									<div class="clearfix"></div>
								</div>
								<div class="x_content">
									<div class="col-md-12 col-sm-12 col-xs-12">
										<div class="col-lg-2 col-md-12 col-xs-12">
											<div class="panel panel-default">
												<div class="panel-body">
													<div class="form-group">
														<label for="mGroup" class="control-label" data-toggle="tooltip" data-placement="right" title="必選項目">受眾選擇*</label>
														<select name="mGroup" id="mGroup" class="form-control" disabled="">
															<option value="none" selected>請選擇受眾</option>
															<option value="all">全會員發送</option>
															<option value="single">單一會員</option>
														</select>
														<p class="help-block">*必選項目</p>
													</div>
													<div class="form-group hidden" id="ToMemberIdGroup">
														<label for="ToMemberId" class="control-label" data-toggle="tooltip" data-placement="right" title="必填項目，請輸入會員ID，請勿輸入會員姓名">會員ID* <i class="fa fa-info-circle" aria-hidden="true"></i></label>
														<input type="text" name="ToMemberId" id="ToMemberId" class="form-control" maxlength="16" value="" disabled>
														<p class="help-block">*必選項目</p>
													</div>
													<div class="form-group hidden">
														<label for="mAttachment" class="control-label">夾帶類型</label>
														<select name="mAttachment" id="mAttachment" class="form-control">
															<option value="0" selected>不夾帶</option>
															<option value="1">卡片</option>
															<option value="2">碎片</option>
															<option value="3">金錢</option>
															<option value="4">點數</option>
															<option value="5">經驗值</option>
														</select>
													</div>
													<div class="form-group hide">
														<label for="mCategory" class="control-label" data-toggle="tooltip" data-placement="right" title="內建內容搜尋，須按照順序輸入關鍵字關鍵字間請用空格隔開">夾帶品項 <i class="fa fa-info-circle" aria-hidden="true"></i></label>
														<select name="mCategory" id="mCategory" class="form-control" disabled="">
															<option value="none" selected>請選擇品項</option>
														</select>
													</div>
													<div class="form-group hide">
														<label for="mQuantity" class="control-label">數量</label>
														<input type="number" id="mQuantity" class="form-control text-center" name="mQuantity" value="0" min="1" style="font-size: 20px;" inputmode="numeric" disabled>
													</div>
													<div class="form-group">
														<label for="ReserveTime" class="control-label" data-toggle="tooltip" data-placement="right" title="若時間設定為現在時間或更早的時間將於1分鐘內送出推播">開始時間 <i class="fa fa-info-circle" aria-hidden="true"></i></label>
														<input type="text" name="ReserveTime" id="ReserveTime" class="form-control" value="" readonly="true" />
													</div>
													<div class="form-group">
														<label for="ReserveFreq" class="control-label" data-toggle="tooltip" data-placement="right" title="設定要連續推播的次數，若設定為1將只推播一次，且不會出現間隔時間欄位。">出現次數 <i class="fa fa-info-circle" aria-hidden="true"></i></label>
														<input type="number" name="ReserveFreq" id="ReserveFreq" class="form-control text-center" value="1" min="1" max="96" />
													</div>
													<div class="form-group hide">
														<label for="ReserveInterval" class="control-label">間隔時間 （分鐘）</label>
														<input type="number" name="ReserveInterval" id="ReserveInterval" class="form-control text-center" value="1" min="1" max="1440" />
													</div>
													<div class="form-group hide">
														<label for="EndTime" class="control-label" data-toggle="tooltip" data-placement="right" title="必須大於最後的推播時間，並預留足夠時間讓玩家開啟推播">獎勵結束時間 <i class="fa fa-info-circle" aria-hidden="true"></i></label>
														<input type="text" name="EndTime" id="EndTime" class="form-control" value="" disabled />
													</div>
												</div>
											</div>
										</div>
										<div class="col-lg-7 col-md-12 col-xs-12">
											<div class="panel panel-default">
												<div class="panel-heading"><span data-toggle="tooltip" data-placement="right" title="黃色標記：玩家若於收到訊息30分鐘內點選訊息，將無法領獎；或是時間已經超過領獎期限。">預計推播時間點預覽 <i class="fa fa-info-circle" aria-hidden="true"></i></span></div>
												<div class="panel-body form-inline" id="TimePreview">
												</div>
											</div>
											<div class="panel panel-default hide">
												<div class="panel-body">
													<table class="table" id="RateTable">
														<thead>
															<tr>
																<td><span data-toggle="tooltip" title="當基數設為0後，即為不夾帶獎勵。此時額外獎勵百分比與自動結算的「領取金額」將會自動停用">獎勵基數 <i class="fa fa-info-circle" aria-hidden="true"></i></span></td>
																<td></td>
																<td><span data-toggle="tooltip" title="百分比設定最低不得低於100%，小數點精度不得高於兩位數">額外獎勵百分比 <i class="fa fa-info-circle" aria-hidden="true"></i></span></td>
																<td></td>
																<td><span data-toggle="tooltip" title="結算金額將無條件捨去小數點">領取金額 <i class="fa fa-info-circle" aria-hidden="true"></i></span></td>
															</tr>
														</thead>
														<tbody>
															<tr>
																<td>
																	<div class="form-group">
																		<input type="number" class="form-control text-center" min="0" value="0" id="baseCoin" name="baseCoin">
																	</div>
																</td>
																<td>
																	<h1>×</h1>
																</td>
																<td>
																	<div class="form-group" id="VIPRateList">
																	</div>
																</td>
																<td>
																	<h1>＝</h1>
																</td>
																<td>
																	<div class="form-group" id="Calc">
																	</div>
																</td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
										</div>
										<div class="col-lg-3 col-md-12 col-xs-12">
											<div class="col-md-12">
											</div>
											<div class="col-md-12">
												<div class="form-group">
													<label for="NotifyTitle" class="control-label" data-toggle="tooltip" data-placement="right" title="必選項目">敘述*</label>
													<input type="text" name="NotifyTitle" id="NotifyTitle" class="form-control length-input" maxlength="50" value="">
												</div>
												<div class="form-group">
													<label for="NotifyContent" class="control-label">廣告內容</label>
													<textarea name="NotifyContent" id="NotifyContent" class="form-control length-input" rows="5" maxlength="200"  required="required"></textarea>
												</div>
												<div class="form-group hide">
													<div class="btn-group btn-group-sm btn-group-justified">
														<a href="javascript:;" id="selectPictureWindow" class="btn btn-success" style="width: 80%;"><i class="fa fa-th" aria-hidden="true"></i> 圖片選擇</a>
														<a href="javascript:;" id="cancelSelectedPicture" class="btn btn-danger" style="width: 20%;"><i class="fa fa-undo" aria-hidden="true"></i> 取消</a>
													</div>
												</div>
												<div class="form-group">
													<input type="hidden" id="picureData" value="">
													<img id="SelectedPicturePreview" src="#" alt="Selected Picture Preview" class="img-responsive img-thumbnail hidden" />
												</div>
											</div>
											<div class="col-md-12">
												<div class="form-group">
													<p class="help-block"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 訊息發送前10分鐘內或已經發送，該訊息組將鎖定無法再被編輯、刪除。</p>
													<p class="help-block"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 續上，若設定多組發送時間，鎖定將以第一組時間計算。</p>
													<button type="button" id="SendAddData" class="btn btn-lg btn-primary pull-right" disabled>確定送出</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12 col-sm-12 col-xs-12">
						<div class="x_panel">
							<div class="x_title">
								<h2>List</h2>
								<div class="clearfix"></div>
							</div>
							<div class="x_content">
								<table id="datatable" class="table table-striped table-bordered">
									<thead>
										<tr>
											<th title="異動時間">廣告ID</th>
											<th title="推播種類">推播
												<br/>種類</th>
											<th title="出現次數">出現
												<br/>次數</th>
											<th title="間隔時間">間隔
												<br/>時間</th>
											<th title="開始日期時間">開始日期時間</th>
											<th title="預計推播時間點預覽">預計推播時間點預覽</th>
											<th title="受眾選擇/會員ID"><span class="label label-default">受眾選擇</span> / 會員ID</th>
											<th title="敘述">敘述</th>
											<th title="廣告內容">廣告內容</th>
											<!-- <th title="數量">數量</th> -->
											<th title="狀態">狀態</th>
											<th title="動作">動作</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /page content -->
			<!--footer-->
		</div>
	</div>
	<!-- jQuery -->
	<script src="../vendors/jquery/dist/jquery.min.js"></script>
	<!-- jquery-ui -->
	<script src="../vendors/jquery-ui/jquery-ui.min.js"></script>
	<script>
	// $.widget.bridge('uibutton', $.ui.button);
	$.widget.bridge('uitooltip', $.ui.tooltip);
	</script>
	<!-- Bootstrap -->
	<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
	<!-- FastClick -->
	<script src="../vendors/fastclick/lib/fastclick.js"></script>
	<!-- NProgress -->
	<script src="../vendors/nprogress/nprogress.js"></script>
	<!-- iCheck -->
	<script src="../vendors/iCheck/icheck.min.js"></script>
	<!-- Datatables -->
	<script src="../vendors/datatables.net/js/jquery.dataTables.min.js"></script>
	<script src="../vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
	<script src="../vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
	<script src="../vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
	<script src="../vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
	<script src="../vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
	<script src="../vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
	<script src="../vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
	<script src="../vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
	<script src="../vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
	<script src="../vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
	<script src="../vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
	<script src="../vendors/jszip/dist/jszip.min.js"></script>
	<script src="../vendors/pdfmake/build/pdfmake.min.js"></script>
	<script src="../vendors/pdfmake/build/vfs_fonts.js"></script>
	<script src="../vendors/moment/min/moment.min.js"></script>
	<script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
	<!-- bootstrap-select -->
	<script src="../vendors/bootstrap-select/js/bootstrap-select.min.js"></script>
	<script src="../vendors/bootstrap-select/js/i18n/defaults-zh_TW.min.js"></script>
	<!-- bootstrap-notify -->
    <script src="../vendors/bootstrap-notify/bootstrap-notify.min.js"></script>
	<!-- Custom Theme Scripts -->
	<script src="../build/js/custom.min.js"></script>
	<script>
	$(document).ready(function() {
		var Type = 'PushNotify';

		var $_GET = {};

		$.each($('#datatable > thead > tr > th'), function(index, val) {
			$(this).attr('title', index);
		});

		document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function() {
			function decode(s) {
				return decodeURIComponent(s.split("+").join(" "));
			}
			$_GET[decode(arguments[1])] = decode(arguments[2]);
		});

		function LoadingEff(effon) {
			if ($('#loading-cover').length < 1) {
				var html = '<div id="loading-cover">' +
					'<div id="loading-icon">' +
					'<i class="fa fa-circle-o-notch fa-spin fa-5x fa-fw" style="color: #FFF;"></i>'
				'</div>' +
				'</div>';
				$('body').append(html);
				$('#loading-cover').css({
					'width': '100%',
					'height': '100%',
					'background': 'rgba(0,0,0,.5)',
					'position': 'fixed',
					'display': 'none',
					'z-index': '999999',
					'top': '0',
					'left': '0'
				});
				$('#loading-icon').css({
					'width': '85px',
					'height': '65px',
					'margin': '-42.5px 0 0 -32.5px',
					'top': '50%',
					'left': '50%',
					'position': 'fixed'
				});
			}
			if (effon) {
				$('#loading-cover').fadeIn(100);
			} else {
				$('#loading-cover').fadeOut(100);
			}
		}

        function QuickNotify(message, type) {
            var icon = "";
            switch(type) {
                case 'success':
                    icon = 'fa-check-circle';
                    break;
                case 'danger':
                    icon = 'fa-times-circle';
                    break;
                default: 
                    icon = 'fa-exclamation-triangle';
            }
            $.notify({
                message: '<h5><i class="fa ' + icon + '"></i> ' + message + '</h5>'
            },{
                type: type,
                z_index: 20000,
                delay: 6000,
            });
        }

		function ShowModalBox(Title, Content, footer, zindex = '999') {
			$('#bs-modal-box-' + zindex).remove();
			var html =
				'<div id="bs-modal-box-' + zindex + '" class="modal fade" tabindex="' + zindex + '" role="dialog">' +
				'<div class="modal-dialog modal-lg" role="document">' +
				'<div class="modal-content">' +
				'<div class="modal-header">' +
				'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
				'<h4 class="modal-title"></h4>' +
				'</div>' +
				'<div class="modal-body" style="display:flow-root">' +
				'<p></p>' +
				'</div>' +
				(footer == null ? '' : '<div class="modal-footer">' + footer + '</div>') +
				'</div>' +
				'</div>' +
				'</div>';
			$('body').append(html);
			$('#bs-modal-box-' + zindex + ' h4.modal-title').html(Title);
			$('#bs-modal-box-' + zindex + ' div.modal-body').html(Content);
			$('#bs-modal-box-' + zindex).modal('show');
		}

		function sizeLimit(input) {
			if ($(input).attr('data-max-filesize') > 0) {
				size = input.files[0].size;
				limit = $(input).attr('data-max-filesize') * 1024;

				if (size > limit) {
					return false;
				} else {
					return true;
				}
			} else {
				return false;
			}
		}

		function getImageSize(input, callback=null){
			var _URL = window.URL || window.webkitURL;
			var file, img;
			file = input.files[0];
			img = new Image();
			img.onload = function () {
				callback(this.width, this.height);
			};
			img.src = _URL.createObjectURL(file);
		}
		// getImageSize(input, function(width, height){
		//     console.log(width, height);
		// });

		function fileTypeChecker(input) {
			if ($(input).attr('accept').length > 0) {
				type = input.files[0].type.toString();
				attType = $(input).attr('accept').toString();
				if (type == attType) {
					return true;
				} else {
					return false;
				}
			} else {
				return false;
			}
		}

		function imagePreview(input, target = null) {
			if (input.files && input.files[0]) {
				if (target == null) {
					if ($(input).next().hasClass('previewImage')) {
						$(input).next().show();
					} else {
						$(input).after('<img src="" class="previewImage img-responsive img-thumbnail" alt="" style="margin-top: 10px;">');
					}
				} else {
					target.removeClass('hidden');
				}
				var reader = new FileReader();
				reader.onload = function(e) {
					if (target == null) {
						$(input).next().attr('src', e.target.result);
					} else {
						target.attr('src', e.target.result);
					}
				}
				reader.readAsDataURL(input.files[0]);
			} else {
				if (target == null) {
					$(input).next().attr('src', "#");
				} else {
					target.addClass('hidden');
					target.attr('src', "#");
				}
			}
		}

		function textLengthInsert(target, text){
			// console.log(!target.next().hasClass('length-text-data'));
			if(!target.next().hasClass('length-text-data')){
				var html = '<p class="help-block text-right length-text-data"></p>';
				target.after(html);
			}
			target.next('.length-text-data').html(text);
		}

		function textLengthPreview(){
			$('.length-input').each(function(index, el) {
				var maxLength = $(el).attr('maxlength') != null ? Number($(el).attr('maxlength')) : '∞';
				var inputLength = $(el).val().length;
				var insertText = inputLength + ' / ' + maxLength;
				textLengthInsert($(el), insertText);
			});

			$(document).on('change keyup', '.length-input', function(event) {
				var maxLength = $(event.target).attr('maxlength') != null ? Number($(event.target).attr('maxlength')) : '∞';
				var inputLength = $(event.target).val().length;
				var insertText = inputLength + ' / ' + maxLength;
				textLengthInsert($(event.target), insertText);
			});
		}
		textLengthPreview();

 
		$('[data-toggle="tooltip"]').tooltip();

		$('#Service, #mAttachment, #Action, #ParameterLobbyOpen, #mGroup').selectpicker({
			showTick: true,
			hideDisable: true
		});

		$('#ReserveTime').daterangepicker({
			locale: {
				format: 'YYYY-MM-DD HH:mm:ss'
			},
			startDate: moment().format('YYYY-MM-DD HH:mm'),
			timePicker: true,
			singleDatePicker: true,
			timePicker24Hour: true,
			// timePickerSeconds: true,
			minDate: moment().format('YYYY-MM-DD HH:mm'),
		});

		$('#EndTime').daterangepicker({
			locale: {
				format: 'YYYY-MM-DD HH:mm:ss'
			},
			startDate: moment().add(5, 'day').format('YYYY-MM-DD HH:mm'),
			timePicker: true,
			singleDatePicker: true,
			timePicker24Hour: true,
			minDate: moment()
		});


		// INIT EVENT
		var AttItemsData = {};
		function mAttachmentParse(mAttachment, ParseData) {
			// console.log(value);
			if (AttItemsData[mAttachment] == null) {
				AttItemsData[mAttachment] = {};
			}
			switch (mAttachment) {
				case '1':
					$.each(ParseData, function(index, value) {
						if (AttItemsData[mAttachment][value.ItemId] == null) {
							AttItemsData[mAttachment][value.ItemId] = {};
						}
						AttItemsData[mAttachment][value.ItemId]['id'] = value.ItemId;
						AttItemsData[mAttachment][value.ItemId]['Name'] = value.ItemName;
						AttItemsData[mAttachment][value.ItemId]['betLevel'] = value.betLevel;
						AttItemsData[mAttachment][value.ItemId]['GameName'] = value.GameName;
						AttItemsData[mAttachment][value.ItemId]['DataContent'] = '<span class=\'label label-warning\'>' + value.GameName + '</span> <span class=\'label label-success\'>Lv-' + value.betLevel + '</span> <span class=\'label label-info\'>' + value.ItemName + '</span>';
					});
					break;
				case '2':
					$.each(ParseData, function(index, value) {
						if (AttItemsData[mAttachment][value.CollectionItemId] == null) {
							AttItemsData[mAttachment][value.CollectionItemId] = {};
						}
						AttItemsData[mAttachment][value.CollectionItemId]['id'] = value.CollectionItemId;
						AttItemsData[mAttachment][value.CollectionItemId]['Name'] = value.CollectionItemName;
						AttItemsData[mAttachment][value.CollectionItemId]['CollectionItemSeriesName'] = value.CollectionItemSeriesName;
						AttItemsData[mAttachment][value.CollectionItemId]['CollectionItemValue'] = value.CollectionItemValue;
						AttItemsData[mAttachment][value.CollectionItemId]['DataContent'] = '<span class=\'label label-warning\'>' + value.CollectionItemSeriesName + '</span> <span class=\'label label-success\'>' + value.CollectionItemValue + '</span> <span class=\'label label-info\'>' + value.CollectionItemName + '</span>';

					});
					// console.log(AttItemsData[2]);
					break;
			}
		}
		var AttData = {};

		function getAttData() {
			$('#mAttachment > option').each(function() {
				AttData[$(this).val()] = $(this).text();
			});
		}
		getAttData();
		function createVIPTable(data, Target, CalcTarget){
			$.each(data, function(index, value) {
				var TargetHtml = '<div class="input-group" data-toggle="tooltip" data-placement="left" title="' + value.VIPLvName + '">' +
					'<span class="input-group-addon" style="width:60px; background-color:#' + value.IconColor + ';">' + value.VIPLvName + '</span>' +
					'<input type="number" name="viprate_' + index + '" class="form-control text-center" step="0.01" value="100" min="100" disabled>' +
					'<span class="input-group-addon" style="background-color:#' + value.IconColor + ';">%</span>' +
					'</div>';
				var CalcHtml = '<div class="input-group">' +
					'<input type="text" class="form-control text-right" value="0" readonly>' +
					'</div>';
				Target.append(TargetHtml);
				CalcTarget.append(CalcHtml);
				Target.find('[data-toggle="tooltip"]').tooltip();
			});
		}

		var vipData = {};
		function getVIPData(Target, CalcTarget) {
			var checkStatus = false;
			// var Target = $('#VIPRateList');
			// var CalcTarget = $('#Calc');
			$.ajax({
				type: 'post',
				url: '/GetVIPSetting',
				data: { other: true },
				cache: false,
				async: true,
				dataType: 'json',
				success: function(result) {
					checkStatus = true;
					vipData = result.data;
					createVIPTable(vipData, Target, CalcTarget);
				}
			}).done(function() {
				if(!checkStatus){
					QuickNotify('取得VIP資料發生錯誤', 'danger');
				}
			});
		}
		getVIPData($('#VIPRateList'), $('#Calc'));

		var DataForCopy = {};
		var mDataTable = $('#datatable').DataTable({
			"lengthMenu": [[30, 50, 100, -1], [30, 50, 100, "∞"]],
			"autoWidth": false,
			"order": [
				[0, "desc"]
			],
			"columnDefs": [{
					"targets": 0,
					"width": "27px",
					"className": "text-center",
				},
				{
					"targets": [1, 2, 3],
					"width": "45px",
					"className": "text-center",
				},
				{
					"targets": 4,
					"width": "100px"
				},
				{
					"targets": 5,
					"width": "330px"
				},
				{
					"targets": 6,
					"width": "80px"
				},
				{
					"targets": 9,
					"width": "45px",
					"className": "text-center"
				},
				{
					"targets": 10,
					"width": "125px"
				},
			]
		});

		function getTableData() {
			mDataTable.clear().draw();

			var Schedule_Done = '<span class="label label-success"><i class="fa fa-check-circle-o" aria-hidden="true"></i> 已送出</span>';
			var Schedule_Wait = '<span class="label label-warning"><i class="fa fa-clock-o" aria-hidden="true"></i> 未送出</span>';

			var EditBtn = function(rowKey) { return '<button type="button" editkey="' + rowKey + '" class="btn btn-default RowEdit" disabled><i class="fa fa-pencil-square-o" aria-hidden="true"></i> 編輯</button>' };
			var CopyBtn = function(rowKey) { return '<button type="button" copykey="' + rowKey + '" class="btn btn-success RowCopy"><i class="fa fa-clone" aria-hidden="true"></i> 拷貝</button>' };
			var DeleBtn = function(rowKey) { return '<button type="button" delekey="' + rowKey + '" class="btn btn-danger RowDelete"><i class="fa fa-trash-o" aria-hidden="true"></i> 刪除</button>' };

			var arrayTableData = [];
			$.ajax({
				type: 'POST',
				url: '/BulletinPushNotify_History',
				cache: false,
				async: true,
				dataType: 'json',
				success: function(result) {
					DataForCopy = result.result;
					// console.log(DataForCopy);

					$.each(result.result, function(index, value) {
						
						var reserveTime = $.parseJSON(value.ReserveTime);
						var timeHTML = "";
						var timeLength = reserveTime.length;
						var timeInterval = 0;

						$.each(reserveTime, function(subindex, subval) {
							timeHTML += 	'<div class="col-sm-5 has-feedback has-success">' +
											'<div class="input-group">' +
											'<span class="input-group-addon" style="width:40px;">' + (subindex + 1) + '</span>' +
											'<input type="text" class="form-control" style="font-size: 12px" value="' + subval + '" readonly>' +
											'</div>'+
											'</div>';
						});
						if(timeLength > 1){
							timeInterval = moment(reserveTime[1]).diff(moment(reserveTime[0]), 'minute')
						} else {
							timeInterval = 0;
						}
						
						arrayTableData.push([
							value.Id,
							'<span class="label label-default">APP推播</span>',
							timeLength,
							timeInterval,
							reserveTime[0],
							timeHTML,
							GroupData[value.mGroup] == null ? value.ToMemberId : '<span class="label label-default text-ellipsis">' + GroupData[value.mGroup] + '</span>',
							'<p class="text-ellipsis">' + value.NotifyTitle + '</p>',
							'<p class="text-ellipsis">' + value.NotifyContent + '</p>',
							// value.mQuantity,
							value.IsSend == 'N' ? Schedule_Wait : Schedule_Done,
							'<div class="btn-group btn-group-xs ctl-btn" style="display: flex;" data-end-time="' + moment(reserveTime[0]).unix() + '">' + EditBtn(index) + CopyBtn(index) + DeleBtn(value.Id) + '</div>'
						]);
					});
				}
			}).done(function() {
				mDataTable.rows.add(arrayTableData).draw();
				$('.text-ellipsis').popover({
					trigger: 'hover',
					placement: 'top',
					html: true,
					content: function() {
						return $(this).text().replace("\n", "<br />", "g");
					},
				});
			});
		}

		function getCategory() {
			$.ajax({
				type: 'GET',
				url: "/BulletinMail_getAttItems",
				cache: false,
				data: { mAttachment: '1' },
				async: true,
				dataType: 'json',
				success: function(msg) {
					// AttItemsData[1] = msg.data;
					mAttachmentParse('1', msg.data);
					$.ajax({
						type: 'GET',
						url: "/BulletinMail_getAttItems",
						cache: false,
						data: { mAttachment: '2' },
						async: true,
						dataType: 'json',
						success: function(msg) {
							// AttItemsData[2] = msg.data;
							mAttachmentParse('2', msg.data);
							getTableData();
						}
					});
				}
			});
		}

		var GroupData = {};

		function getmGroup() {
			var checkStatus = false;
			var targetSelect = $('#mGroup');

			$.ajax({
				type: 'GET',
				url: "/BulletinMail_getmGroup",
				cache: false,
				async: true,
				dataType: 'json',
				success: function(msg) {
					checkStatus = true;
					targetSelect.prop('disabled', false);
					getCategory();
					msg.data.forEach(function(value) {
						targetSelect.append('<option data-content="<div class=\'label label-success\'>' + value.count + ' 人</div> ' + value.AudienceName + '" value="' + value.Id + '">' + value.AudienceName + '</option>');
						GroupData[value.Id] = value.AudienceName;
					});
					targetSelect.selectpicker('refresh');
				}
			}).done(function() {
				if(!checkStatus){
					QuickNotify('取得Group資料發生錯誤', 'danger');
				} else {
					$.each(targetSelect.find('option'), function(index, element) {
						GroupData[$(element).attr('value')] = $(element).text();
					});
				}
			})
		}
		getmGroup();

		var LangList = {}; // 語言列表(Arrray)
		var LangOption = ''; // 語言列表(html)

		function getLangList() {
			$.ajax({
				url: '/getLangList',
				type: 'POST',
				cache: false,
				async: true,
				dataType: 'json',
				success: function(data) {
					$.each(data.data, function(index, value) {
						LangList[value.Code] = value.Lang.toString();
					});
					LangOption = '';
					LangOption += '<select class="form-control item-lang">';
					$.each(LangList, function(index, value) {
						LangOption += '<option value="' + index + '">' + value + '</option>';
					});
					LangOption += '</select>';
				}
			});
		}
		getLangList();


		function getGalleryData(type, order = 'DESC', selectedPicture = null) {
			if (Object.keys(LangList) <= 0) {
				QuickNotify('載入語言選單發生問題', 'danger');
				getLangList();
			}
			$.ajax({
				url: '/GetPictures',
				type: 'POST',
				data: { type: type, order: order },
				cache: false,
				async: true,
				dataType: 'json',
				success: function(data) {
					var html = '<li class="pull-left ui-disabled well" style="margin-top: 6px; height: 165px;">' +
						'<div class="form-group">' +
						'<div class="pinSize">' +
						'<img src="#" alt="圖片上傳預覽，檔案大小必須為800KB以內，且為jpg格式。" id="picturePreview" class="img-responsive">' +
						'</div>' +
						'<label for="pictureFile">於項目內新增相片</label>' +
						'<input type="file" id="pictureFile" name="pictureFile" style="width:60px; font-size:12px;" class="pull-left" accept="image/jpeg" data-max-filesize="800" />' +
						// '<p class="help-block">檔案大小必須為800KB以內，且為jpg格式。</p>' +
						'<button type="button" id="SendPicture" class="btn btn-xs btn-primary pull-right" disabled><i class="fa fa-upload" aria-hidden="true"></i></button>' +
						'</div>' +
						'</li>';
					$('#gallery-sortable').html(html);
					$.each(data.data, function(index, value) {
						var imageSrc = '../vendors/Backend/fileupload/album/' + Type + '/' + value.Picture;
						var html =
							'<li class="pull-left" data-pid="' + value.pid + '">' +
							'<div class="thumbnail">' +
							'<div class="edit-over-item hide">' +
							'<div class="form-group form-group-sm">' +
							'<input type="text" class="form-control item-annotation" value="' + value.Annotation + '" />' +
							'</div>' +
							'<div class="form-group form-group-sm">' +
							LangOption +
							'</div>' +
							'<div class="form-group form-group-sm">' +
							'<div class="btn-group btn-group-xs btn-group-justified">' +
							'<a href="javascript:;" class="btn btn-primary edit-picture-send"><i class="fa fa-check-circle" aria-hidden="true"></i> 確定</a>' +
							'<a href="javascript:;" class="btn btn-default edit-picture-cancel"><i class="fa fa-undo" aria-hidden="true"></i> 取消</a>' +
							'</div>' +
							'</div>' +
							'</div>' +
							'<div class="pinSize">' +
							'<div class="over-img-block">' +
							'<span class="label label-default">' + LangList[value.Lang] + '</span>' +
							'<div class="pull-right">' +
							'<input class="pictureSelected" type="radio" name="pictureSelected" id="pictureSelected_' + value.pid + '" value="' + value.pid + '" ' + (value.pid==selectedPicture?'checked':'') + ' data-picsrc="' + value.Picture + '">' +
							'</div>' +
							'</div>' +
							'<img src="' + imageSrc + '" alt="" class="img-responsive">' +
							'</div>' +
							'<div class="caption">' +
							'<p>' + value.Annotation + '</p>' +
							'<div class="btn-group btn-group-xs btn-group-justified">' +
							'<a href="javascript:;" class="edit-picture btn btn-success"><i class="fa fa-pencil" aria-hidden="true"></i> 編輯</a>' +
							'<a href="javascript:;" data-pid="' + value.pid + '" class="picture-del btn btn-danger"><i class="fa fa-trash" aria-hidden="true"></i> 刪除</a>' +
							'</div>' +
							'</div>' +
							'</div>' +
							'</li>';
						$('#gallery-sortable').append(html);
						var optionSelect = $('#gallery-sortable li[data-pid="' + value.pid + '"] .over-img-block > div.form-group > select > option');
						$.each(optionSelect, function(index, element) {
							$(element).prop('selected', $(element).attr('value') == value.Lang ? true : false);
						});
					});
					$("#gallery-sortable").sortable({
						cursor: "move",
						delay: 300,
						tolerance: "pointer",
						cancel: "input, select",
						items: "li:not(.ui-disabled)",
						placeholder: "pull-left",
						classes: {
							"ui-sortable-placeholder": "ui-state-highlight"
						}
					});
					$("#gallery-sortable").disableSelection();
				}
			});
		}

		function LinkMemberId() {
			if ($_GET['MemberId'] != null) {
				$('#mGroup').val('single');
				$('#ToMemberId').val($_GET['MemberId']);
				SmartForm($('#mAttachment'), $('#mCategory'), $('#NotifyTitle'), $('#mGroup'), $('#ToMemberId'), $('#SendAddData'), $('#mQuantity'), $('#ToMemberIdGroup'));
			}
		}
		LinkMemberId();
		// INIT EVENT

		// Other GET / POST
		function ItemsDataOption(mAttachment, Selected = 'none') {
			var targetSelect = $('#mCategory');
			switch (mAttachment.toString()) {
				case '1':
					targetSelect.children('option').not('[value="none"]').remove();
					$.each(AttItemsData[mAttachment], function(index, value) {
						var data_tokens = value.GameName + ' ' + value.betLevel + ' ' + value.Name;
						targetSelect.append('<option value="' + value.id + '" data-tokens="' + data_tokens + '" data-content="' + value.DataContent + '">' + value.Name + '</option>');
					});
					break;
				case '2':
					targetSelect.children('option').not('[value="none"]').remove();
					$.each(AttItemsData[mAttachment], function(index, value) {
						var data_tokens = value.CollectionItemSeriesName + ' ' + value.CollectionItemValue + ' ' + value.Name;
						targetSelect.append('<option value="' + value.id + '" data-tokens="' + data_tokens + '" data-content="' + value.DataContent + '">' + value.Name + '</option>');
					});
					break;
			}
			targetSelect.find('option[value="' + Selected + '"]').prop('selected', true);
		}

		function SmartForm(mAttachment, mCategory, NotifyTitle, mGroup, ToMemberId, sendButton, mQuantity, ToMemberIdGroup) {
			var str_mAttachment = mAttachment.val().toString();
			var str_mCategory = mCategory.val().toString();
			var str_NotifyTitle = NotifyTitle.val().toString();
			var str_mGroup = mGroup.val().toString();
			var str_ToMemberId = ToMemberId.val().toString();

			if ((str_mGroup == 'single' && str_ToMemberId.length < 5) || str_NotifyTitle.length < 1 || str_mGroup == 'none') {
				sendButton.prop('disabled', true);
			} else {
				sendButton.prop('disabled', false);
			}

			switch (str_mAttachment) {
				case '1':
					mCategory.prop('disabled', false);
					break;
				case '2':
					mCategory.prop('disabled', false);
					break;
				case '3':
					mQuantity.prop('disabled', false);
					mCategory.prop('disabled', true);
					mCategory.find('[value="none"]').prop('selected', true);
					break;
				default:
					mCategory.prop('disabled', true);
					mQuantity.prop('disabled', true);
					mCategory.find('[value="none"]').prop('selected', true);
					break;
			}
			mCategory.selectpicker('refresh');

			// alert(mCategory);
			// console.log(mAttachment, mCategory);
			if ((str_mAttachment != '3' && str_mCategory == 'none') || (str_mCategory == 'none' && str_mAttachment == '0')) {
				mQuantity.prop('disabled', true);
				mQuantity.val('0');
			} else {
				mQuantity.prop('disabled', false);
				mQuantity.val(mQuantity.val() > 1 ? mQuantity.val() : "1");
			}

			if (str_mGroup == "single") {
				ToMemberIdGroup.removeClass('hidden');
				ToMemberId.prop('disabled', false);
			} else {
				ToMemberIdGroup.addClass('hidden');
				ToMemberId.prop('disabled', true);
			}
		}

		var vipRateData = [];
		vipRateData['add'] = [];
		vipRateData['edit'] = [];

		function SmartRateCalc(event = null, endTime, baseCoin, mAttachment, mQuantity, VIPRateList, Calc, arrayName) {
			// var endTime = $('#EndTime');
			// var baseCoin = $('#baseCoin');
			// var mAttachment = $('#mAttachment');
			// var mQuantity = $('#mQuantity');
			// var VIPRateList = $('#VIPRateList');
			// var Calc = $('#Calc');
			// var Calc
			var rate = VIPRateList.find('input[type="number"]');
			var calcData = Calc.find('input[type="text"]');

			mQuantity.val(baseCoin.val());
			vipRateData[arrayName] = [];
			if (Number(baseCoin.val()) <= 0) {
				baseCoin.val('0');
				rate.prop('disabled', true);
				endTime.prop('disabled', true);
				endTime.prop('readonly', false);
				endTime.parent().addClass('hide');
				mAttachment.val('0').selectpicker('refresh');
				calcData.val('0');
			} else {
				rate.prop('disabled', false);
				endTime.prop('disabled', false);
				endTime.prop('readonly', true);
				endTime.parent().removeClass('hide');
				mAttachment.val('3').selectpicker('refresh');
				if (baseCoin.val().split(".").length > 1) {
					baseCoin.val(Math.floor(baseCoin.val()));
					QuickNotify('此欄位僅限輸入整數', 'warning');
				}
				
				$.each(rate, function(index, element) {
					// 當小數點位數 > 指定值
					var getStep = Number($(element).attr('step').split(".")[1].length);
					var getMin = Number($(element).attr('min'));
					var selfVal = $(element).val();
					if (selfVal.split(".").length > 1 && selfVal.split(".")[1].length > getStep) {
						$(element).val(Math.round(selfVal * 100) / 100);
						QuickNotify('[' + $(element).prev().text() + '] : 項目精度超出預設，已經將位數精度調整為小數點後2位。', 'warning');
					}
					if (selfVal < getMin && (event.type != 'keyup' || event == null)) {
						$(element).val(getMin);
						QuickNotify('[' + $(element).prev().text() + '] : 項目最小值不得低於100%，或輸入格式不符，已經將項目調整至容許最小值。', 'warning');
					}
					vipRateData[arrayName].push($(element).val() * 100);
				});
				$.each(calcData, function(index, element) {
					var fin = Math.floor((Number(rate.eq(index).val()) * Number(baseCoin.val())) / 100);
					$(element).val(fin);
				});
			}
		}

		var postTimeJSON = [];
		function SmartTimeCalc(reserveFreq, reserveTime, reserveInterval, endTime, baseCoin, timePreview, previewSize, arrayName) {

			var FreqNum = Number(reserveFreq.val());
			var ReserveTime_format = moment(reserveTime.val()).format("YYYY-MM-DD HH:mm");
			var html = "";

			var TimeJSON = [];
			timePreview.html('');

			if (reserveFreq.val().split(".").length > 1 ||
				!$.isNumeric(reserveFreq.val()) ||
				reserveFreq.val() < reserveFreq.attr('min')) {
				reserveFreq.val(reserveFreq.attr('min'));
				QuickNotify('此欄位僅限輸入正整數(次數)', 'warning');
			}

			if (reserveInterval.val().split(".").length > 1 ||
				!$.isNumeric(reserveInterval.val()) ||
				reserveInterval.val() < reserveInterval.attr('min')) {
				reserveInterval.val(reserveInterval.attr('min'));
				QuickNotify('此欄位僅限輸入正整數(間隔)', 'warning');
			}

			if (FreqNum <= 1) {
				reserveInterval.parent().addClass('hide');
			} else {
				reserveInterval.parent().removeClass('hide');
			}

			for (var i = 0; i < FreqNum; i++) {
				var addTime = moment(ReserveTime_format).add(reserveInterval.val() * i, 'm').format("YYYY-MM-DD HH:mm:ss");
				TimeJSON.push(addTime);
			}

			$.each(TimeJSON, function(index, value) {
				var isOverEndTime = EndTimeChecker(value, endTime.val(), baseCoin);
				var TimePreviewHtml = 
					'<div class="col-lg-' + previewSize + ' col-sm-12 has-feedback ' + (isOverEndTime ? 'has-error' : 'has-success') + '">' +
					'<div class="input-group">' +
					'<span class="input-group-addon" style="width:40px;">' + (index + 1) + '</span>' +
					'<input type="text" class="form-control" style="font-size: 12px" value="' + value + '" readonly>' +
					'<span class="fa ' + (isOverEndTime ? 'fa-exclamation-triangle' : 'fa-check-circle') + ' form-control-feedback" aria-hidden="true"></span>' +
					'</div>'+
					'</div>';
				timePreview.append(TimePreviewHtml);
			});

			postTimeJSON[arrayName] = [];
			var timePreviewInput = timePreview.find('.has-success input');
			$.each(timePreviewInput, function(index, element) {
				var TimeData = $(element).val();
				postTimeJSON[arrayName].push(TimeData);
			});

		}
		SmartTimeCalc($('#ReserveFreq'), $('#ReserveTime'), $('#ReserveInterval'), $('#EndTime'), $('#baseCoin'), $('#TimePreview'), 3, 'add');

		function EndTimeChecker(a, b, baseCoin){
			a = moment(a);
			b = moment(b);
			var diff = b.diff(a, 's');
			if(diff <= 1800 && baseCoin.val() > 0){
				return true;
			} else {
				return false;
			}
		}

		function selectPictureWindow(insertPicture) {
			var html = '<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">' +
				'<ul id="gallery-sortable" class="list-unstyled row ui-sortable">' +
				'</ul>' +
				'</div>';

			var footer = '<div class="btn-group btn-group-lg" style="margin-right: 10px;">' +
				'<button id="' + insertPicture + '" type="button" class="btn btn-primary insertPicture" disabled><i class="fa fa-picture-o" aria-hidden="true"></i> 確定選取</button>' +
				'<button id="sendPictureOrder" type="button" class="btn btn-info"><i class="fa fa-sort-amount-desc" aria-hidden="true"></i> 儲存順序</button>' +
				'</div>' +
				'<button type="button" class="btn btn-danger btn-lg" data-dismiss="modal"><i class="fa fa-undo" aria-hidden="true"></i> 取消</button>';

			var zindex = 9999;
			ShowModalBox('Image Selector', html, footer, zindex);
			$('#bs-modal-box-' + zindex).on('shown.bs.modal', function(e) {
				getGalleryData(Type, 'ASC');
			});
		}

		function SendPicture() {
			var data = new FormData();
			var files = $("#pictureFile").get(0).files;
			if (files.length > 0) {
				data.append("uploadImage", files[0]);
			};
			data.append('type', Type);

			LoadingEff(true);
			$.ajax({
				url: '/SendPicture',
				type: 'POST',
				data: data,
				cache: false,
				async: true,
				processData: false,
				contentType: false,
				success: function(data) {
					getGalleryData(Type, 'ASC');
				}
			}).always(function() {
				LoadingEff(false);
			});
		}

		function pictureDel() {
			var confirmData = confirm("確定要刪除？");
			var checkStatus = false;

			if (confirmData) {
				var pid = $(this).attr('data-pid');
				var _element = $(this).parents('li.ui-sortable-handle');
				$.ajax({
					url: '/DelPicture',
					type: 'POST',
					data: { pid: pid },
					cache: false,
					async: true,
					dataType: 'json',
					success: function(data) {
						_element.remove();
						checkStatus = true;
					}
				}).always(function() {
					if (!checkStatus)
						QuickNotify('刪除發生錯誤', 'danger');
				});
			}
		}

		function pictureEdit(targetForm, targetOther) {
			if (targetForm.hasClass('hide')) {
				targetForm.removeClass('hide');
				targetOther.addClass('blur');
			} else {
				targetForm.addClass('hide');
				targetOther.removeClass('blur');
			}
		}

		function pictureEditOpen() {
			targetForm = $(this).parents('.thumbnail').find('.edit-over-item');
			targetOther = $(this).parents('.thumbnail').find('.pinSize, .caption');
			pictureEdit(targetForm, targetOther);
		}

		function itemEditHide(selectNum) {
			targetForm = $('#gallery-sortable > li > .thumbnail').eq(selectNum).find('.edit-over-item');
			targetOther = $('#gallery-sortable > li > .thumbnail').eq(selectNum).find('.pinSize, .caption');
			pictureEdit(targetForm, targetOther);
		}

		function editPictureSend() {
			var pid = $(this).parents('li[data-pid]').attr('data-pid');
			var annotation = $(this).parents('div.edit-over-item').find('.item-annotation').val();
			var lang = $(this).parents('div.edit-over-item').find('.item-lang').val();
			var thisEq = $(this).parents('li[data-pid]').prevAll().not('.ui-disabled').length;

			if ($(this).hasClass('edit-picture-send')) {
				var checkStatus = false;

				$.ajax({
					url: '/EditPicture',
					type: 'POST',
					data: { pid: pid, annotation: annotation, lang: lang },
					cache: false,
					async: true,
					dataType: 'json',
					success: function(data) {
						checkStatus = true;
					}
				}).always(function() {
					if (!checkStatus) {
						QuickNotify('編輯發生錯誤', 'danger');
					}
					itemEditHide(thisEq);
					getGalleryData(Type, 'ASC');
				});
			} else {
				itemEditHide(thisEq);
			}
		}

		function sendPictureOrder() {
			var checkStatus = false;
			var item = $('#gallery-sortable > li').not('.ui-disabled');
			var postData = [];
			$(item).each(function(index, el) { //.get().reverse() -> 應應 SQL ORDER BY DESC
				postData.push({ 'pid': $(this).attr('data-pid'), 'no': index });
			});
			console.log(postData);
			$.ajax({
				url: '/OrderPicture',
				type: 'POST',
				data: JSON.stringify({ data: postData }),
				cache: false,
				async: true,
				contentType: 'application/json',
				processData: false,
				success: function(data) {
					checkStatus = true;
				}
			}).always(function() {
				if (!checkStatus) {
					QuickNotify('更新順序發生錯誤', 'danger');
				} else {
					QuickNotify('更新順序成功', 'success');
					getGalleryData(Type, 'ASC');
				}
			});
		}

		function pictureSelected() {
			$.each($('#gallery-sortable > li[data-pid]'), function(index, element) {
				if($(element).find('input.pictureSelected').prop('checked')){
					$(element).addClass('selected');
				} else {
					$(element).removeClass('selected');
				}
			});
			if ($('#gallery-sortable input.pictureSelected:checked').val() != null) {
				$('.insertPicture').prop('disabled', false);
			} else {
				$('.insertPicture').prop('disabled', true);
			}
		}

		function insertPicture(previewTarget, insertTarget, zindex) {
			// var previewTarget = $('#SelectedPicturePreview');
			// var insertTarget = $('#picureData');

			var insertPictureData = $('#gallery-sortable input.pictureSelected:checked').val();
			var insertPictureSrc = $('#gallery-sortable input.pictureSelected:checked').attr('data-picsrc');

			if (insertPictureData != null) {
				insertTarget.val(insertPictureData);
				previewTarget.attr('src', '../vendors/Backend/fileupload/album/' + Type + '/' + insertPictureSrc);
				previewTarget.removeClass('hidden');
				$('#bs-modal-box-' + zindex).modal('hide');
			} else {
				QuickNotify('沒有任何選項被選擇，請選擇圖片！', 'warning');
				previewTarget.addClass('hidden');
			}
		}

		function cancelSelectedPicture(previewTarget, insertTarget) {
			// var previewTarget = $('#SelectedPicturePreview');
			// var insertTarget = $('#picureData');

			var confirmAlert = confirm("確定取消選取的圖片？");
			if (confirmAlert) {
				insertTarget.val('');
				previewTarget.attr('src', '#');
				previewTarget.addClass('hidden');
			} else {}
		}

		function showPicturePreviewModal() {
			var Content = $(this)[0].outerHTML;
			var lang = $(this).prev().find('span')[0].outerHTML;
			var annotation = $(this).parents('.thumbnail').find('.caption > p').text();
			var Title = lang + ' ' + annotation;

			ShowModalBox(Title, Content, null, '99999');

		}

		// document Event
		$(document).on('change focus keyup', '#mGroup, #NotifyTitle, #mCategory, #ToMemberId', function(){
			SmartForm($('#mAttachment'), $('#mCategory'), $('#NotifyTitle'), $('#mGroup'), $('#ToMemberId'), $('#SendAddData'), $('#mQuantity'), $('#ToMemberIdGroup'));
		});

		$(document).on('change focus keyup', '#edit_mGroup, #edit_NotifyTitle, #edit_mCategory, #edit_ToMemberId', function(){
			SmartForm($('#edit_mAttachment'), $('#edit_mCategory'), $('#edit_NotifyTitle'), $('#edit_mGroup'), $('#edit_ToMemberId'), $('#SendEditData'), $('#edit_mQuantity'), $('#edit_ToMemberIdGroup'));
		});

		$(document).on('change focus keyup click', '#baseCoin, #VIPRateList input[type="number"]', function(event){
			SmartRateCalc(event, $('#EndTime'), $('#baseCoin'), $('#mAttachment'), $('#mQuantity'), $('#VIPRateList'), $('#Calc'), 'add');
			SmartTimeCalc($('#ReserveFreq'), $('#ReserveTime'), $('#ReserveInterval'), $('#EndTime'), $('#baseCoin'), $('#TimePreview'), 3, 'add');
		});

		$(document).on('change focus keyup click', '#ReserveFreq, #ReserveInterval, #ReserveTime, #EndTime', function(){
			SmartTimeCalc($('#ReserveFreq'), $('#ReserveTime'), $('#ReserveInterval'), $('#EndTime'), $('#baseCoin'), $('#TimePreview'), 3, 'add');
		});

		$(document).on('change focus keyup click', '#edit_ReserveFreq, #edit_ReserveInterval, #edit_ReserveTime, #edit_EndTime', function(){
			SmartTimeCalc($('#edit_ReserveFreq'), $('#edit_ReserveTime'), $('#edit_ReserveInterval'), $('#edit_EndTime'), $('#edit_baseCoin'), $('#edit_TimePreview'), 4, 'edit');
		});

		$(document).on('change focus keyup click', '#edit_baseCoin, #edit_VIPRateList input[type="number"]', function(event){
			SmartRateCalc(event, $('#edit_EndTime'), $('#edit_baseCoin'), $('#edit_mAttachment'), $('#edit_mQuantity'), $('#edit_VIPRateList'), $('#edit_Calc'), 'edit');
			SmartTimeCalc($('#edit_ReserveFreq'), $('#edit_ReserveTime'), $('#edit_ReserveInterval'), $('#edit_EndTime'), $('#edit_baseCoin'), $('#edit_TimePreview'), 4, 'edit');
		});

		$(document).on('change', '#mAttachment', function(event) {
			var mAttachment = $(this).val();
			ItemsDataOption(mAttachment);
			SmartForm($('#mAttachment'), $('#mCategory'), $('#NotifyTitle'), $('#mGroup'), $('#ToMemberId'), $('#SendEditData'), $('#mQuantity'), $('#ToMemberIdGroup'));
		});

		$(document).on('change', '#pictureFile', function(event) {
			var overLimit = sizeLimit(this);
			var allowType = fileTypeChecker(this);
			if (!overLimit || !allowType) {
				$(this).val('');
				var msg = (!overLimit ? "Size Over Limit \n" : "") + (!allowType ? "File Type Error" : "");
				alert(msg);
				$('#SendPicture').prop('disabled', true);
			} else {
				$('#SendPicture').prop('disabled', false);
			}
			imagePreview(this, $('#picturePreview'));
		});

		$(document).on('click', '#SendAddData', function(event) {
			var confirmAlert = confirm("確定要新增系統推播？");
			var ToMemberId = $('#mGroup').val() == 'single' ? $('#ToMemberId').val() : null; // 單一會員寄送防呆

			if(confirmAlert){
				var postData = {
					mGroup: $('#mGroup').val(),
					ToMemberId: ToMemberId,
					mAttachment: $('#mAttachment').val(),
					mCategory: $('#mCategory').val(),
					mQuantity: $('#mQuantity').val(),
					ReserveTime: JSON.stringify(postTimeJSON['add']),
					vipRateData: JSON.stringify(vipRateData['add']),
					EndTime: $('#EndTime').val(),
					NotifyTitle: $('#NotifyTitle').val(),
					NotifyContent: $('#NotifyContent').val(),
					LinkPicture: $('#picureData').val()
				};
				$.ajax({
					type: 'POST',
					url: "/BulletinPushNotify_Add",
					data: postData,
					cache: false,
					async: true,
					dataType: 'json',
					success: function(result) {
						if (result.code == "0") {
							getTableData();
							QuickNotify('新增成功！', 'success');
						} else {
							if(result.error == "No MemberId found"){
								QuickNotify('指定的會員並不存在', 'danger');
							} else {
								QuickNotify('新增失敗，寫入資料發生非預期錯誤', 'danger');
							}
						}
					},
					error: function() {
						QuickNotify('連線失敗', 'danger');
					}
				});
			}

		});

		$(document).on('click', '#SendEditData', function(event) {
			var ToMemberId = $('#edit_mGroup').val() == 'single' ? $('#edit_ToMemberId').val() : null; // 單一會員寄送防呆

			var postData = {
				Id: $('#SendEditData').attr('data-update-id'),
				mGroup: $('#edit_mGroup').val(),
				ToMemberId: ToMemberId,
				mAttachment: $('#edit_mAttachment').val(),
				mCategory: $('#edit_mCategory').val(),
				mQuantity: $('#edit_mQuantity').val(),
				ReserveTime: JSON.stringify(postTimeJSON['edit']),
				vipRateData: JSON.stringify(vipRateData['edit']),
				EndTime: $('#edit_EndTime').val(),
				NotifyTitle: $('#edit_NotifyTitle').val(),
				NotifyContent: $('#edit_NotifyContent').val(),
				LinkPicture: $('#edit_picureData').val()
			};
			console.log(postData);

			// return;

			$.ajax({
				type: 'POST',
				url: "/BulletinPushNotify_Edit",
				data: postData,
				cache: false,
				async: true,
				dataType: 'json',
				success: function(result) {
					if (result.code == "0") {
						getTableData();
						$('#bs-modal-box-999').modal('hide');
						QuickNotify('修改成功', 'success');
					} else {
						QuickNotify('修改失敗', 'danger');
					}
				},
				error: function() {
					QuickNotify('修改失敗', 'danger');
				}
			});
		});

		$(document).on('click', '.RowCopy', function(event) {
			if (DataForCopy == null) {
				QuickNotify('資料錯誤，請重新整理', 'danger');
			} else {
				var copyData = DataForCopy[$(this).attr('copykey')];
				console.log(copyData);
				vipRateData['add'] = $.parseJSON(copyData.vipRateData); // VIP資料
				var reserveTime = $.parseJSON(copyData.ReserveTime); // 預約時間
				var reserveFreq = reserveTime.length; // 出現次數
				var reserveInterval = reserveFreq <= 1 ? 1 : (moment(reserveTime[1]).unix() - moment(reserveTime[0]).unix()) / 60; // 間隔時間
				var mGroup_option = '';

				$('#mGroup').selectpicker('val', copyData.mGroup == null ? 'single' : copyData.mGroup).selectpicker('refresh');
				// $('#mGroup').val(copyData.ToMemberId != null ? 'single' : copyData['mGroup']);
				$('#ReserveFreq').val(reserveFreq);
				$('#ReserveInterval').val(reserveInterval);
				$('#baseCoin').val(copyData['mQuantity']);
				$('#NotifyTitle').val(copyData['NotifyTitle']);
				$('#NotifyContent').val(copyData['NotifyContent']);
                $('#ToMemberId').val(copyData.mGroup == null ? copyData.ToMemberId : '');

				$.each(vipRateData['add'], function(index, val) {
					$('#VIPRateList > div > input').eq(index).val(val / 100);
				});

				SmartTimeCalc($('#ReserveFreq'), $('#ReserveTime'), $('#ReserveInterval'), $('#EndTime'), $('#baseCoin'), $('#TimePreview'), 4, 'add');

				SmartRateCalc(null, $('#EndTime'), $('#baseCoin'), $('#mAttachment'), $('#mQuantity'), $('#VIPRateList'), $('#Calc'), 'add');

				SmartForm($('#mAttachment'), $('#mCategory'), $('#NotifyTitle'), $('#mGroup'), $('#ToMemberId'), $('#SendAddData'), $('#mQuantity'), $('#ToMemberIdGroup'));
            	QuickNotify('複製完成', 'success');
			}
		});

		$(document).on('click', '.RowEdit', function(event) {
			if (DataForCopy == null) {
				QuickNotify('資料錯誤，請重新整理', 'danger');
			} else {
				var editData = DataForCopy[$(this).attr('editkey')];
			}
			console.log(editData);
			vipRateData['edit'] = $.parseJSON(editData.vipRateData); // VIP資料
			var reserveTime = $.parseJSON(editData.ReserveTime); // 預約時間
			var reserveFreq = reserveTime.length; // 出現次數
			var reserveInterval = reserveFreq <= 1 ? 1 : (moment(reserveTime[1]).unix() - moment(reserveTime[0]).unix()) / 60; // 間隔時間
			// console.log(reserveFreq, reserveInterval, (moment(ReserveTime[1]).unix() - moment(ReserveTime[0]).unix()));
			var mGroup_option = '';

			$.each($('#mGroup > option'), function(index, element) {
				var data_content = $(element).attr('data-content') != null ? ' data-content="' + $(element).attr('data-content') + '" ' : ' ';
				var selected = $(element).attr('value') == editData.mGroup ? 'selected' : '';
				mGroup_option += '<option value="' + $(element).attr('value') + '"' + data_content + selected + '>' + $(element).text() + '</option>\n';
			});

			var mGroup_html =   '<div class="form-group">' +
									'<label for="edit_mGroup" class="control-label" data-toggle="tooltip" data-placement="right" title="必選項目">受眾選擇*</label>' +
										'<select name="edit_mGroup" id="edit_mGroup" class="form-control">' +
											mGroup_option +
										'</select>' +
									'<p class="help-block">*必選項目</p>' +
								'</div>';

								// (editData.mGroup == 'single' ? '' : 'hidden')
			var ToMemberId_html =   '<div class="form-group hidden" id="edit_ToMemberIdGroup">' +
										'<label for="edit_ToMemberId" class="control-label" data-toggle="tooltip" data-placement="right" title="必填項目，請輸入會員ID，請勿輸入會員姓名">會員ID* <i class="fa fa-info-circle" aria-hidden="true"></i></label>' +
										'<input type="text" name="edit_ToMemberId" id="edit_ToMemberId" class="form-control" value="" disabled="">' +
										'<p class="help-block">*必選項目</p>' +
									'</div>';

			var mAttachment_html =  '<div class="form-group hidden">' +
										'<label for="edit_mAttachment" class="control-label">夾帶類型</label>' +
										'<select name="edit_mAttachment" id="edit_mAttachment" class="form-control">' +
											'<option value="0" selected>不夾帶</option>' +
											'<option value="1">卡片</option>' +
											'<option value="2">碎片</option>' +
											'<option value="3">金錢</option>' +
											'<option value="4">點數</option>' +
											'<option value="5">經驗值</option>' +
										'</select>' +
									'</div>';

			var mCategory_html =    '<div class="form-group hide">' +
										'<label for="edit_mCategory" class="control-label" data-toggle="tooltip" data-placement="right" title="內建內容搜尋，須按照順序輸入關鍵字關鍵字間請用空格隔開">夾帶品項 <i class="fa fa-info-circle" aria-hidden="true"></i></label>' +
										'<select name="edit_mCategory" id="edit_mCategory" class="form-control">' +
											'<option value="none" selected>請選擇品項</option>' +
										'</select>' +
									'</div>';

			var mQuantity_html =    '<div class="form-group hide">' +
										'<label for="edit_mQuantity" class="control-label">數量</label>' +
										'<input type="number" id="edit_mQuantity" class="form-control text-center" name="edit_mQuantity" value="' + editData.mQuantity + '" min="1" style="font-size: 20px;" inputmode="numeric" disabled>' +
									'</div>';

			var ReserveTime_html =  '<div class="form-group">' +
										'<label for="edit_ReserveTime" class="control-label" data-toggle="tooltip" data-placement="right" title="若時間設定為現在時間或更早的時間將於1分鐘內送出推播">開始時間 <i class="fa fa-info-circle" aria-hidden="true"></i></label>' +
										'<input type="text" name="edit_ReserveTime" id="edit_ReserveTime" class="form-control" value="' + reserveTime[0] + '" readonly="true" />' +
									'</div>';

			var ReserveFreq_html =  '<div class="form-group">' +
										'<label for="edit_ReserveFreq" class="control-label" data-toggle="tooltip" data-placement="right" title="設定要連續推播的次數，若設定為1將只推播一次，且不會出現間隔時間欄位。">出現次數 <i class="fa fa-info-circle" aria-hidden="true"></i></label>' +
										'<input type="number" name="edit_ReserveFreq" id="edit_ReserveFreq" class="form-control text-center" min="1" value="' + reserveFreq + '" />' +
									'</div>';

			var ReserveInterval_html =  '<div class="form-group">' +
											'<label for="edit_ReserveInterval" class="control-label">間隔時間 （分鐘）</label>' +
											'<input type="number" name="edit_ReserveInterval" id="edit_ReserveInterval" class="form-control text-center" value="' + reserveInterval + '" min="1" />' +
										'</div>';

			var EndTime_html =  '<div class="form-group hide">' +
									'<label for="edit_EndTime" class="control-label" data-toggle="tooltip" data-placement="right" title="必須大於最後的推播時間，並預留足夠時間讓玩家開啟推播">獎勵結束時間 <i class="fa fa-info-circle" aria-hidden="true"></i></label>' +
									'<input type="text" name="edit_EndTime" id="edit_EndTime" class="form-control" value="' + editData.EndTime + '" disabled />' +
								'</div>';

			var html =  '<div class="col-lg-5 col-md-12 col-xs-12">' +
							'<div class="panel panel-default">' + 
								'<div class="panel-body">' +
									mGroup_html +
									ToMemberId_html +
									mAttachment_html +
									mCategory_html +
									mQuantity_html +
									ReserveTime_html +
									ReserveFreq_html +
									ReserveInterval_html +
									EndTime_html +
								'</div>' +
							'</div>' +
						'</div>';
			html    +=  '<div class="col-md-7">' +
							'<div class="form-group">' +
								'<label for="edit_NotifyTitle" class="control-label" data-toggle="tooltip" data-placement="right" title="" data-original-title="必選項目" val="">敘述*</label>' +
								'<input type="text" name="edit_NotifyTitle" id="edit_NotifyTitle" class="form-control length-input" maxlength="50" value="">' +
							'</div>' +
							'<div class="form-group">' +
								'<label for="edit_NotifyContent" class="control-label">廣告內容</label>' +
								'<textarea name="edit_NotifyContent" id="edit_NotifyContent" class="form-control length-input" rows="5" maxlength="200" required="required"></textarea>' +
							'</div>' +
							'<div class="form-group">' +
								'<div class="btn-group btn-group-sm btn-group-justified">' +
									'<a href="javascript:;" id="edit_selectPictureWindow" class="btn btn-success" style="width: 80%;"><i class="fa fa-th" aria-hidden="true"></i> 圖片選擇</a>' +
									'<a href="javascript:;" id="edit_cancelSelectedPicture" class="btn btn-danger" style="width: 20%;"><i class="fa fa-undo" aria-hidden="true"></i> 取消</a>' +
								'</div>' +
							'</div>' +
							'<div class="form-group">' +
								'<input type="hidden" id="edit_picureData" value="">' +
								'<img id="edit_SelectedPicturePreview" src="#" alt="Selected Picture Preview" class="img-responsive img-thumbnail hidden">' +
							'</div>' +
							'<div class="form-group">' +
								'<p class="help-block"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 訊息發送前10分鐘內或已經發送，該訊息組將鎖定無法再被編輯、刪除。</p>' + 
								'<p class="help-block"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> 續上，若設定多組發送時間，鎖定將以第一組時間計算。</p>' +
								// '<button type="button" id="SendAddData" class="btn btn-lg btn-primary pull-right" disabled>確定送出</button>' +
							'</div>' +
						'</div>';

			html    +=  '<div class="col-lg-12 col-md-12 col-xs-12">' +
							'<div class="panel panel-default">' +
								'<div class="panel-heading"><span data-toggle="tooltip" data-placement="right" title="黃色標記：玩家若於收到訊息30分鐘內點選訊息，將無法領獎；或是時間已經超過領獎期限。">發送時間預覽 <i class="fa fa-info-circle" aria-hidden="true"></i></span></div>' +
								'<div class="panel-body form-inline" id="edit_TimePreview">' +
								'</div>' +
							'</div>' +
							'<div class="panel panel-default">' +
								'<div class="panel-body">' +
									'<table class="table" id="edit_RateTable">' +
										'<thead>' +
											$('#RateTable > thead').html() +
										'</thead>' +
										'<tbody>' +
											'<tr>' +
												'<td>' +
													'<div class="form-group">' +
														'<input type="number" class="form-control text-center" min="0" value="' + editData.mQuantity + '" id="edit_baseCoin" name="edit_baseCoin">' +
													'</div>' +
												'</td>' +
												'<td>' +
													'<h1>×</h1>' +
												'</td>' +
												'<td>' +
													'<div class="form-group" id="edit_VIPRateList">' +
													'</div>' +
												'</td>' +
												'<td>' +
													'<h1>＝</h1>' +
												'</td>' +
												'<td>' +
													'<div class="form-group" id="edit_Calc">' +
													'</div>' +
												'</td>' +
											'</tr>' +
										'</tbody>' +
									'</table>' +
								'</div>' +
							'</div>' +
						'</div>';
			var zindex = 999;
			var footer = 
				'<div class="btn-group btn-group-lg" style="margin-right: 10px;">' +
				'<button id="SendEditData" data-update-id="' + editData.Id + '" type="button" class="btn btn-primary" disabled><i class="fa fa-pencil" aria-hidden="true"></i> 確定修改</button>' +
				'<button type="button" class="btn btn-danger btn-lg" data-dismiss="modal"><i class="fa fa-undo" aria-hidden="true"></i> 取消</button>';

			ShowModalBox('Edit', html, footer, zindex);
			createVIPTable(vipData, $('#edit_VIPRateList'), $('#edit_Calc'));

			$('#bs-modal-box-' + zindex).on('shown.bs.modal', function(e) {
				$('#edit_NotifyTitle').val(editData.NotifyTitle);
				$('#edit_NotifyContent').val(editData.NotifyContent);

				$('#edit_RateTable').find('[data-toggle="tooltip"]').tooltip();

				$.each(vipRateData['edit'], function(index, val) {
					$('#edit_VIPRateList > div > input').eq(index).attr('value', val / 100);
				});

				SmartTimeCalc($('#edit_ReserveFreq'), $('#edit_ReserveTime'), $('#edit_ReserveInterval'), $('#edit_EndTime'), $('#edit_baseCoin'), $('#edit_TimePreview'), 4, 'edit');

				SmartRateCalc(null, $('#edit_EndTime'), $('#edit_baseCoin'), $('#edit_mAttachment'), $('#edit_mQuantity'), $('#edit_VIPRateList'), $('#edit_Calc'), 'edit');

				SmartForm($('#edit_mAttachment'), $('#edit_mCategory'), $('#edit_NotifyTitle'), $('#edit_mGroup'), $('#edit_ToMemberId'), $('#SendEditData'), $('#edit_mQuantity'), $('#edit_ToMemberIdGroup'));

				textLengthPreview();
				
				$('#edit_mGroup').selectpicker();

				$('#edit_ReserveTime').daterangepicker({
					locale: {
						format: 'YYYY-MM-DD HH:mm:ss'
					},
					// startDate: moment().format('YYYY-MM-DD HH:mm'),
					timePicker: true,
					singleDatePicker: true,
					timePicker24Hour: true,
					// timePickerSeconds: true,
					// minDate: moment(),
				});

				$('#edit_EndTime').daterangepicker({
					locale: {
						format: 'YYYY-MM-DD HH:mm:ss'
					},
					// startDate: moment().add(5, 'day').format('YYYY-MM-DD HH:mm'),
					timePicker: true,
					singleDatePicker: true,
					timePicker24Hour: true,
					// minDate: moment()
				});
			});

			$('#bs-modal-box' + zindex).on('hide.bs.modal', function(e) {
				$('#edit_mGroup').selectpicker('destroy');
			});
			
			// console.log(mGroup_option);
		});

		$(document).on('click', '.RowDelete', function(event) {
			var confirmAlert = confirm("確定要刪除？");
			if (confirmAlert) {
				var thisRow = $(this);
				$.post('/BulletinPushNotify_Delete', { delekey: $(this).attr('delekey') }, function(data, textStatus, xhr) {
					mDataTable.row(thisRow.parents('tr')).remove().draw();
				});
			} else {}
		});

		$(document).on('change', '.pictureSelected', pictureSelected);

		$(document).on('click', '#selectPictureWindow', function(){
			selectPictureWindow('insertPicture');
		});

		$(document).on('click', '#edit_selectPictureWindow', function(){
			selectPictureWindow('edit_insertPicture');
		});

		$(document).on('click', '#SendPicture', SendPicture);

		$(document).on('click', '.picture-del', pictureDel);

		$(document).on('click', '.edit-picture', pictureEditOpen);

		$(document).on('click', '.edit-picture-send, .edit-picture-cancel', editPictureSend);

		$(document).on('click', '#sendPictureOrder', sendPictureOrder);

		$(document).on('click', '#insertPicture', function(){
			insertPicture($('#SelectedPicturePreview'), $('#picureData'), '9999');
		});

		$(document).on('click', '#edit_insertPicture', function(){
			insertPicture($('#edit_SelectedPicturePreview'), $('#edit_picureData'), '9999');
		});

		$(document).on('click', '#cancelSelectedPicture', function(){
			cancelSelectedPicture($('#SelectedPicturePreview'), $('#picureData'));
		});

		$(document).on('click', '#edit_cancelSelectedPicture', function(){
			cancelSelectedPicture($('#edit_SelectedPicturePreview'), $('#edit_picureData'));
		});

		$(document).on('click', '#gallery-sortable .thumbnail img', showPicturePreviewModal);


		// 多重視窗相容性
		$(document).on('hidden.bs.modal', function (event) {
			if($('.modal:visible').length) {
				$('body').addClass('modal-open');
			}
		});

		$(document).on('show.bs.modal', function (event) {
			var modalLength = $('.modal').length;
			$.each($('.modal').get().reverse(), function(index, element) {
				var new_zindex = 1050 - (index * 20);
				$(element).css('z-index', new_zindex);
				$(element).next('.modal-backdrop').css('z-index', new_zindex - 15);
			});
		});

		$(document).on('change keyup keydown focus click', '#ReserveFreq, #ReserveInterval', function(event) {
            var maxValue = Number($(this).attr('max'));
            var getValue = Number($(this).val());
            if(maxValue != null){
                if (getValue > maxValue) {
                    QuickNotify('數字超出系統容許大小：' + maxValue + '。\n已自動將數值降至容許最大值。', 'warning');
                    $(this).val(maxValue);
                }
            }
        });

		// sendPictureOrder

		// $('input[name="EndTime"]').on('apply.daterangepicker', function(ev, picker) {
		//     $(this).val(picker.startDate.format('YYYY-MM-DD HH:mm:ss'));
		// });

		// $('input[name="EndTime"]').on('cancel.daterangepicker', function(ev, picker) {
		//     $(this).val('');
		// });


	});
	</script>
</body>

</html>