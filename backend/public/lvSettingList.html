<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SCG</title>
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->
    <link href="../vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="../vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
</head>

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <!--Menu&Top-->
            <!-- page content -->
            <div class="right_col" role="main">
                <div class="row">
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Lv Settings</h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <toolbar></toolbar>
                                    <table id="datatable" class="table table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>LvId</th>
                                                <th>LvName</th>
                                                <th>LvExpLimitNum</th>
                                                <th>LvPrize</th>
                                                <th>VipExp</th>
                                                <th>BetLimit</th>
                                                <th>ItemPackageId</th>
                                                <th>DailyBouns</th>
                                                <th>TimelyBouns</th>
                                                <th>CollectId</th>
                                                <th>功能</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /page content -->
            <!--footer-->
        </div>
    </div>
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- Datatables -->
    <script src="../vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="../vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="../vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="../vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="../vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
    <script src="../vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="../vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
    <script src="../vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
    <script src="../vendors/jszip/dist/jszip.min.js"></script>
    <script src="../vendors/pdfmake/build/pdfmake.min.js"></script>
    <script src="../vendors/pdfmake/build/vfs_fonts.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>
    <script>

    $(document).ready(function() {
        var table = $('#datatable').DataTable({
            destroy: true,
            "columnDefs": [
              {"targets": 0,"visible": false,"searchable": false},
              {"targets": 1,"visible": true,"searchable": true},
              {"targets": 2,"visible": true,"searchable": true},
              {"targets": 3,"visible": true,"searchable": true},
              {"targets": 4,"visible": true,"searchable": true},
              {"targets": 5,"visible": true,"searchable": true},
              {"targets": 6,"visible": true,"searchable": true},
              {"targets": 7,"visible": true,"searchable": true},
              {"targets": 8,"visible": true,"searchable": true},
              {"targets": 9,"visible": true,"searchable": true},
              {"targets": 10,}
            ]
        });

        $("toolbar").html('<button id="rowAdd">新增</button>');

        //點選新增
        $("button#rowAdd").on('mousedown', "", function(e){
            table.row.add([
                "",
                "<input type='text' id='LvName' value=''/>",
                "<input type='text' id='LvExpLimitNum' value=''/>",
                "<input type='text' id='LvPrize' value=''/>",
                "<input type='text' id='VipExp' value=''/>",
                "<input type='text' id='BetLimit' value=''/>",
                "<input type='text' id='ItemPackageId' value=''/>",
                "<input type='text' id='DailyBouns' value=''/>",
                "<input type='text' id='TimelyBouns' value=''/>",
                "<input type='text' id='CollectId' value=''/>",
                "<button id='save'>新增</button><button id='cancelAdd'>取消</button>"
                ]).draw();
        });

        //處理新增
        $(document).on('click', 'button#save', function(event) {
            if(confirm("確定存檔嗎?")){
                var parentsTR = $(this).closest("tr");
                var tempForm =  new Object();
                tempForm.LvId = null;
                tempForm.LvName = parentsTR.find("input#LvName").val();
                tempForm.LvExpLimitNum = parentsTR.find("input#LvExpLimitNum").val();
                tempForm.LvPrize = parentsTR.find("input#LvPrize").val();
                tempForm.VipExp = parentsTR.find("input#VipExp").val();
                tempForm.BetLimit = parentsTR.find("input#BetLimit").val();
                tempForm.ItemPackageId = parentsTR.find("input#ItemPackageId").val();
                tempForm.DailyBouns = parentsTR.find("input#DailyBouns").val();
                tempForm.TimelyBouns = parentsTR.find("input#TimelyBouns").val();
                tempForm.CollectId = parentsTR.find("input#CollectId").val();

                if(checkObjectValue(tempForm)){
                    $.ajax({
                        type: 'POST',
                        url: "/lvSettingAdd",
                        cache: false,
                        async: true,
                        data: tempForm,
                        dataType: 'json',
                        success: function(msg) {
                            var code = msg.code;
                            var message = msg.msg;
                            var insertId = msg.insertId;
                            if(code==0){
                                parentsTR.find("td").each(function(index){
                                    if($(this).find("input").length>0){
                                        $(this).html("<colName id='"+$(this).find("input").attr("id")+"'>"+$(this).find("input").val()+"</colName>");
                                    }
                                    if($(this).find("button").length>0){
                                        $(this).html("<input type='hidden' id='LvId' value='"+insertId+"' /><button id='modify'>修改</button><button id='delete'>刪除</button>");
                                    }
                                });

                            }
                            alert(message);
                        }
                    });
                }
            }
        });

        //取消新增
        $(document).on('click', 'button#cancelAdd', function(event) {
            var parentsTR = $(this).closest("tr").addClass("cancelAdd");
            table.row(".cancelAdd").remove().draw(false);
        });

        //取得列表
        $.ajax({
            type: 'POST',
            url: "/lvSettingList",
            cache: false,
            async: true,
            dataType: 'json',
            success: function(msg) {
                msg.data.forEach(function(value) {
                    var nowRow = table.row;
                    nowRow.add([
                        "<colName id='LvId'>"+value.LvId+"</colName>",
                        "<colName id='LvName'>"+(value.LvName==null?"":value.LvName)+"</colName>",
                        "<colName id='LvExpLimitNum'>"+(value.LvExpLimitNum==null?"":value.LvExpLimitNum)+"</colName>",
                        "<colName id='LvPrize'>"+(value.LvPrize==null?"":value.LvPrize)+"</colName>",
                        "<colName id='VipExp'>"+(value.VipExp==null?"":value.VipExp)+"</colName>",
                        "<colName id='BetLimit'>"+(value.BetLimit==null?"":value.BetLimit)+"</colName>",
                        "<colName id='ItemPackageId'>"+(value.ItemPackageId==null?"":value.ItemPackageId)+"</colName>",
                        "<colName id='DailyBouns'>"+(value.DailyBouns==null?"":value.DailyBouns)+"</colName>",
                        "<colName id='TimelyBouns'>"+(value.TimelyBouns==null?"":value.TimelyBouns)+"</colName>",
                        "<colName id='CollectId'>"+(value.CollectId==null?"":value.CollectId)+"</colName>",
                        "<input type='hidden' id='LvId' value='"+value.LvId+"' /><button id='modify'>修改</button><button id='delete'>刪除</button>"
                    ]).draw();
                });
            }
        });

        //修改
        $(document).on('click', 'button#modify', function(event) {
            var tds = $(this).closest("tr").find("td");
            tds.each(function(index){
                if($(this).find("colName").length>0){
                    $(this).html("<input type='text' id='"+$(this).find("colName").attr("id")+"' value='"+$(this).find("colName").html()+"'/>");
                }
                if($(this).find("button").length>0){
                    $(this).html("<input type='hidden' id='LvId' value='"+$(this).find("input#LvId").val()+"' /><button id='modifyGo'>修改</button><button id='modifyCancel'>取消</button>");
                }
            });
        });

        //取消修改
        $(document).on('click', 'button#modifyCancel', function(event) {
            var parentsTR = $(this).closest("tr");
            parentsTR.find("td").each(function(index){
                if($(this).find("input[type='text']").length>0){
                    $(this).html("<colName id='"+$(this).find("input").attr("id")+"'>"+$(this).find("input").val()+"</colName>");
                }
                if($(this).find("button").length>0){
                    $(this).html("<input type='hidden' id='LvId' value='"+$(this).find("input#LvId").val()+"' /><button id='modify'>修改</button><button id='delete'>刪除</button>");
                }
            });
        });

        //處理修改
        $(document).on('click', 'button#modifyGo', function(event) {
            if(confirm("確定修改嗎?")){
                var parentsTR = $(this).closest("tr");
                var tempForm =  new Object();
                tempForm.LvId = $(this).closest("td").find("input#LvId").val();
                tempForm.LvName = parentsTR.find("input#LvName").val();
                tempForm.LvExpLimitNum = parentsTR.find("input#LvExpLimitNum").val();
                tempForm.LvPrize = parentsTR.find("input#LvPrize").val();
                tempForm.VipExp = parentsTR.find("input#VipExp").val();
                tempForm.BetLimit = parentsTR.find("input#BetLimit").val();
                tempForm.ItemPackageId = parentsTR.find("input#ItemPackageId").val();
                tempForm.DailyBouns = parentsTR.find("input#DailyBouns").val();
                tempForm.TimelyBouns = parentsTR.find("input#TimelyBouns").val();
                tempForm.CollectId = parentsTR.find("input#CollectId").val();
                if(checkObjectValue(tempForm)){
                    $.ajax({
                        type: 'POST',
                        url: "/lvSettingModify",
                        cache: false,
                        async: true,
                        data: tempForm,
                        dataType: 'json',
                        success: function(msg) {
                            var code = msg.code;
                            var message = msg.msg;
                            if(code==0){
                                parentsTR.find("td").each(function(index){
                                    if($(this).find("input[type='text']").length>0){
                                        $(this).html("<colName id='"+$(this).find("input").attr("id")+"'>"+$(this).find("input").val()+"</colName>");
                                    }
                                    if($(this).find("button").length>0){
                                        $(this).html("<input type='hidden' id='LvId' value='"+$(this).find("input#LvId").val()+"' /><button id='modify'>修改</button><button id='delete'>刪除</button>");
                                    }
                                });
                            }
                            alert(message);
                        }
                    });
                }
            }
        });

        //處理刪除
        $(document).on('click', 'button#delete', function(event) {
            if(confirm("確定刪除LvName="+$(this).closest("tr").find("colName#LvName").html()+"嗎?")){
                var parentsTR = $(this).closest("tr");
                var tempForm =  new Object();
                tempForm.LvId = $(this).closest("td").find("input#LvId").val();

                if(tempForm.LvId != ""){
                    $.ajax({
                        type: 'POST',
                        url: "/lvSettingDelete",
                        cache: false,
                        async: true,
                        data: tempForm,
                        dataType: 'json',
                        success: function(msg) {
                            var code = msg.code;
                            var message = msg.msg;
                            if(code==0){
                              parentsTR.addClass("cancelAdd");
                              table.row(".cancelAdd").remove().draw(false);
                            }
                            alert(message);
                        }
                    });
                }
            }
        });


        //檢查物件
        function checkObjectValue(tempForm){

            if(tempForm.LvName.trim() == ""){
                alert("LvName不可為空");
                return false;
            }
            if(tempForm.LvExpLimitNum.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("LvExpLimitNum格式有誤");
                return false;
            }
            if(tempForm.LvPrize.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("LvPrize格式有誤");
                return false;
            }
            if(tempForm.VipExp.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("VipExp格式有誤");
                return false;
            }
            if(tempForm.BetLimit.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("BetLimit格式有誤");
                return false;
            }
            if(tempForm.ItemPackageId.trim() == ""){
                tempForm.ItemPackageId=null;
            }
            if(tempForm.DailyBouns.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("DailyBouns格式有誤");
                return false;
            }
            if(tempForm.TimelyBouns.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                alert("TimelyBouns格式有誤");
                return false;
            }
            if(tempForm.CollectId.trim() == "" || isNaN(tempForm.LvExpLimitNum)){
                tempForm.CollectId=null;
            }
            return true;
        }
    });

    </script>
</body>

</html>
